import{r as R,h as te,s as N,R as h,y as C}from"./index-DgwETXXl.js";import{I as me,A as ie}from"./index-CgFL_Lmt.js";import{C as re,a as ae,b as de,c as be}from"./card-Bd3wj2iC.js";import{S as B,a as U,b as P,c as K,d as L}from"./select-C9VQ6xlo.js";import{u as ce}from"./useSubjects-DrAFZSlr.js";import{S as he,F as fe,r as ge,u as W,C as z,a as ye}from"./readXlsxFileBrowser-DyJMMn5k.js";import{u as _}from"./useMutation-CWkqDcyF.js";import{q as w,u as Ee}from"./queryKeys-DRwUXBOd.js";import{T as pe,a as we,b as H,c as Re,d as xe,e as Q}from"./table-DaPbKzvm.js";import{B as V}from"./badge-D_6PR6ji.js";import{B as T}from"./button-JwqKODJ6.js";import{L as Se,A as ke,a as je}from"./alert-CYx-5lkx.js";import{u as ne}from"./useTeachers-BUIP1BjG.js";import{C as ve}from"./circle-alert-lgjGWSdq.js";import{U as Ne}from"./users-DTvBPDpn.js";import{P as Te}from"./plus-DKWVuoAd.js";import{m as J}from"./proxy-BwaxQ4ZJ.js";import{X as Z}from"./x-UGlBcBjw.js";import{C as O}from"./check-B3DRr4vU.js";import{M as Ce}from"./mail-C-B26gZ_.js";import{T as _e}from"./trash-2-FAIOSQOX.js";import"./utils-CHUdG8Hq.js";import"./index-CyI_JP6F.js";import"./index-CHRW_5Qr.js";import"./index-B96c5szH.js";import"./createLucideIcon-BsWjkkVR.js";import"./index-Ciz9C784.js";function Ae({onSearchChange:e,onSubjectChange:r}){const{subjects:t}=ce(),[s,m]=R.useState(""),[d,b]=R.useState("all"),u=c=>{const n=c.target.value;m(n),e(n)},i=c=>{b(c),r(c==="all"?null:c)};return React.createElement(re,{className:"bg-card text-card-foreground border border-border shadow-sm"},React.createElement(ae,{className:"p-4"},React.createElement("div",{className:"flex flex-col md:flex-row gap-4"},React.createElement("div",{className:"flex-1 relative"},React.createElement(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),React.createElement(me,{placeholder:"Search teachers...",value:s,onChange:u,className:"pl-10 bg-background text-foreground placeholder:text-muted-foreground border-border"})),React.createElement(B,{value:d,onValueChange:i},React.createElement(U,{className:"w-[200px] bg-background text-foreground border-border"},React.createElement(P,{placeholder:"All Subjects"})),React.createElement(K,{className:"bg-popover text-popover-foreground border border-border shadow-md"},React.createElement(L,{value:"all"},"All Subjects"),t.map(c=>React.createElement(L,{key:c.subject_name,value:c.subject_name},c.subject_name)))))))}async function qe(e){if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Invalid teacher payload");if(!e.email)throw new Error("Teacher must include an email");const{data:r,error:t}=await N.functions.invoke("teacher-creation",{body:e});if(t)throw console.error("Edge function error:",t),new Error(t.message||"Failed to create teacher");return r}async function Fe({id:e,updates:r}){const{data:t,error:s}=await N.from("teacher_profile").update(r).eq("id",e).select("*").single();if(s)throw new Error(s.message||"Failed to update teacher");return t}async function Ie(e){const{error:r}=await N.from("teacher_profile").delete().eq("id",e);if(r)throw new Error(r.message||"Failed to delete teacher");return{id:e}}function X({createOptions:e,updateOptions:r,deleteOptions:t}={}){const s=te(),m=_({mutationFn:qe,onSuccess:async(u,i,c)=>{s.setQueryData(w.teachers.all,n=>{const o=Array.isArray(n)?n:[];return[u,...o]}),await s.invalidateQueries({queryKey:w.teachers.all}),e?.onSuccess&&e.onSuccess(u,i,c)},onError:(u,i,c)=>{e?.onError&&e.onError(u,i,c)},...e}),d=_({mutationFn:Fe,onSuccess:async(u,i,c)=>{s.setQueryData(w.teachers.all,n=>Array.isArray(n)?n.map(o=>o?.id===u?.id?{...o,...u}:o):n),await s.invalidateQueries({queryKey:w.teachers.all}),r?.onSuccess&&r.onSuccess(u,i,c)},onError:(u,i,c)=>{r?.onError&&r.onError(u,i,c)},...r}),b=_({mutationFn:Ie,onSuccess:async(u,i,c)=>{const n=u?.id??i;s.setQueryData(w.teachers.all,o=>Array.isArray(o)?o.filter(S=>S?.id!==n):o),await s.invalidateQueries({queryKey:w.teachers.all}),t?.onSuccess&&t.onSuccess(u,i,c)},onError:(u,i,c)=>{t?.onError&&t.onError(u,i,c)},...t});return{createTeacher:m.mutate,createTeacherAsync:m.mutateAsync,updateTeacher:d.mutate,updateTeacherAsync:d.mutateAsync,deleteTeacher:b.mutate,deleteTeacherAsync:b.mutateAsync,createStatus:m,updateStatus:d,deleteStatus:b}}const ee=["Professor","Associate Professor","Assistant Professor","Lecturer","Senior Lecturer"],Le=["name","email","emp_id","subjects","designation","max_hours"],I=[{key:"name",label:"Name",width:"w-[20%]"},{key:"emp_id",label:"Employee ID",width:"w-[10%]"},{key:"subjects",label:"Subjects",width:"w-[15%]"},{key:"designation",label:"Designation",width:"w-[15%]"},{key:"email",label:"Email",width:"w-[20%]"},{key:"max_hours",label:"Max Hours",width:"w-[10%]"},{key:"actions",label:"",width:"w-[10%]"}];function Me({}){const{createTeacherAsync:e,updateTeacherAsync:r}=X(),{teachers:t}=ne(),[s,m]=R.useState(""),[d,b]=R.useState(!1),u=async i=>{const c=i.target.files[0];if(c){b(!0),m("");try{const n=await ge(c),S=n[0].map(f=>f&&typeof f=="string"?f?.toLowerCase():""),A=Le.filter(f=>!S?.includes(f?.toLowerCase()));if(A.length>0){m(`Missing columns: ${A.join(", ")}`),b(!1);return}const y={};S.forEach((f,g)=>{y[f]=g});const M=[],q=[];for(let f=1;f<n.length;f++){const g=n[f];if(g.every(F=>F===null||F===""))continue;const E={name:g[y.name]||"",email:g[y.email]||"",emp_id:String(g[y.emp_id]||""),department:g[y.department]||"",designation:g[y.designation]||"",max_hours:parseInt(g[y.max_hours])||20,subjects:[]};if(!E?.name||!E?.email||!E?.emp_id)continue;const j=t.find(F=>F?.emp_id===E?.emp_id||F?.email?.toLowerCase()===E?.email?.toLowerCase());j?q.push({id:j.id,updates:E}):M.push(E)}if(M.length===0&&q.length===0){m("No valid teacher data found in the file"),b(!1);return}let D=0,$=0,k=[];for(const f of M)try{await e(f),D++}catch(g){k.push(`Add error for ${f.name}: ${g.message}`)}for(const{id:f,updates:g}of q)try{await r({id:f,updates:g}),$++}catch(E){k.push(`Update error for ${g.name}: ${E.message}`)}k.length>0?m(k.join(`
`)):(C.success(`Successfully imported ${D} new teachers and updated ${$} existing teachers.`),i.target.value=null)}catch(n){m(`Error processing file: ${n.message}`)}b(!1)}};return h.createElement("div",null,h.createElement(T,{variant:"outline",onClick:()=>document.getElementById("excelFileInput").click(),className:"border-border hover:bg-accent hover:text-accent-foreground transition-colors",disabled:d},d?h.createElement(h.Fragment,null,h.createElement(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."):h.createElement(h.Fragment,null,h.createElement(fe,{className:"w-4 h-4 mr-2"}),"Import Excel")),h.createElement("input",{id:"excelFileInput",type:"file",className:"hidden",accept:".xlsx",onChange:u,disabled:d}),s&&h.createElement(ke,{variant:"destructive",className:"mt-4 bg-destructive/10 text-destructive border border-destructive/30 dark:bg-destructive/20"},h.createElement(ve,{className:"h-4 w-4"}),h.createElement(je,null,s)))}const De=Object.freeze([]);async function $e(){const{data:e,error:r}=await N.from("teacher_subjects").select("*");if(r)throw new Error(r.message||"Failed to load teacher subjects");return e??[]}function se(e={}){const{teachersSubjectQueryOptions:r={}}=e,t=Ee({queryKey:w.teacherSubjects.all,queryFn:$e,staleTime:10*6e4,...r}),s=!!t.isLoading,m=!!t.isError,d=t.error??null,b=async()=>{const[u]=await Promise.all([t.refetch()]);return{teacherSubjects:u.data??[]}};return{teacherSubjects:t.data??De,isLoading:s,isError:m,error:d,refetch:b,teachersSubjectQuery:t}}async function Qe(e){const{data:r,error:t}=await N.from("teacher_subjects").insert([e]).select("*").single();if(t)throw new Error(t.message||"Failed to link teacher with subject");return r}async function Be({teacher:e,subject:r}){const{data:t,error:s}=await N.from("teacher_subjects").update({subject:r}).eq("teacher",e).select("*").single();if(s)throw new Error(s.message||"Failed to update teacher");return t}async function Ue({teacher:e,subject:r}){const{error:t}=await N.from("teacher_subjects").delete().eq("teacher",e).eq("subject",r);if(t)throw new Error(t.message||"Failed to unlink teacher from subject");return{teacher:e,subject:r}}async function Pe({teacher:e,subject:r}){const{error:t}=await N.from("teacher_subjects").delete().eq("teacher",e);if(t)throw new Error(t.message||"Failed to reset teacher subjects");if(!r||r.length===0)return[];const{data:s,error:m}=await N.from("teacher_subjects").insert(r.map(d=>({teacher:e,subject:d}))).select("*");if(m)throw new Error(m.message||"Failed to insert teacher subjects");return s}function Ke({createOptions:e,editingOptions:r,deleteOptions:t,bulkReplaceOptions:s}={}){const m=te(),d=_({mutationFn:Qe,onSuccess:async(c,n,o)=>{m.invalidateQueries({queryKey:w.teacherSubjects.all}),e?.onSuccess&&e.onSuccess(c,n,o)},onError:(c,n,o)=>{e?.onError&&e.onError(c,n,o)},...e}),b=_({mutationFn:Be,onSuccess:async(c,n,o)=>{m.invalidateQueries({queryKey:w.teacherSubjects.all}),r?.onSuccess&&r.onSuccess(c,n,o)},onError:(c,n,o)=>{r?.onError&&r.onError(c,n,o)},...r}),u=_({mutationFn:Ue,onSuccess:async(c,n,o)=>{m.invalidateQueries({queryKey:w.teacherSubjects.all}),t?.onSuccess&&t.onSuccess(c,n,o)},onError:(c,n,o)=>{t?.onError&&t.onError(c,n,o)},...t}),i=_({mutationFn:Pe,onSuccess:async(c,n,o)=>{m.invalidateQueries({queryKey:w.teacherSubjects.all}),s?.onSuccess&&s.onSuccess(c,n,o)},onError:(c,n,o)=>{s?.onError&&s.onError(c,n,o)},...s});return{createTeacherSubject:d.mutate,createTeacherSubjectAsync:d.mutateAsync,editTeacherSubject:b.mutate,editTeacherSubjectAsync:b.mutateAsync,deleteTeacherSubject:u.mutate,deleteTeacherSubjectAsync:u.mutateAsync,bulkReplaceTeacherSubjects:i.mutate,bulkReplaceTeacherSubjectsAsync:i.mutateAsync,createStatus:d,editStatus:b,deleteStatus:u,bulkReplaceStatus:i}}function ze({filteredTeacher:e}){const{deleteTeacherAsync:r,createTeacherAsync:t}=X(),[s,m]=R.useState(null),[d,b]=R.useState(!1),[u,i]=R.useState(null),{teacherSubjects:c,isLoading:n}=se(),{subjects:o}=ce(),{createTeacherSubjectAsync:S,deleteTeacherSubjectAsync:A}=Ke(),{register:y,handleSubmit:M,reset:q,control:D,formState:{errors:$}}=W(),{register:k,handleSubmit:f,reset:g,control:E,setValue:j,formState:{errors:F}}=W(),oe=async a=>{if(!confirm(`Delete teacher "${a.name}"?`))return;const p=c.find(l=>l.teacher===a.name);p&&await A({teacher:a.name,subject:p.subject}),await r(a.id)},le=a=>{i(a.id),j("name",a.name),j("emp_id",a.emp_id),j("subjects",a.subjects||""),j("designation",a.designation),j("email",a.email),j("max_hours",a.max_hours)},ue=async a=>{if($&&Object.keys($).length>0){C.error("Please fill all required fields correctly.");return}const{subjects:p,...l}=a;await t(l),await S({teacher:a.name,subject:p}),q(),b(!1)},Y=({onClick:a})=>React.createElement(T,{size:"sm",variant:"outline",onClick:a},React.createElement(ye,{className:"w-3 h-3"})),G=({onClick:a})=>React.createElement(T,{size:"sm",variant:"outline",onClick:a,className:"text-red-600 hover:text-red-700"},React.createElement(_e,{className:"w-3 h-3"}));return React.createElement(re,{className:"bg-card text-card-foreground border border-border shadow-sm"},React.createElement(de,null,React.createElement(be,{className:"flex items-center gap-2 text-foreground"},React.createElement(Ne,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),"Teachers (",e.length,")",React.createElement("div",{className:"flex gap-2 ml-auto"},React.createElement(T,{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white dark:from-blue-600 dark:to-blue-700 dark:hover:from-blue-500 dark:hover:to-blue-600",onClick:()=>b(!0)},React.createElement(Te,{className:"w-4 h-4 mr-2"}),"Add Teacher"),React.createElement(Me,{teachers:e})))),React.createElement(ae,null,React.createElement("div",{className:"overflow-x-auto"},React.createElement(pe,{className:"table-fixed w-full"},React.createElement(we,null,React.createElement(H,null,I.map(a=>React.createElement(Re,{key:a.key,className:a.width},a.label)))),React.createElement(xe,null,React.createElement(ie,null,n?React.createElement(H,null,React.createElement(Q,{colSpan:I.length,className:"text-center py-8 text-muted-foreground"},"Loading teachers...")):e.length===0?React.createElement(H,null,React.createElement(Q,{colSpan:I.length,className:"text-center py-8 text-muted-foreground"},"No teachers found")):e.map((a,p)=>React.createElement(J.tr,{key:a.id,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:p*.05},className:"hover:bg-accent hover:text-accent-foreground transition-colors",onMouseEnter:()=>m(a.id),onMouseLeave:()=>m(null)},u===a.id?I.map(l=>React.createElement(Q,{key:l.key},l.key==="name"&&React.createElement("input",{...k("name",{required:!0}),className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border"}),l.key==="emp_id"&&React.createElement("input",{...k("emp_id",{required:!0}),className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border"}),l.key==="subjects"&&React.createElement(z,{name:"subjects",control:E,rules:{required:!0},render:({field:v})=>React.createElement(B,{value:v.value,onValueChange:v.onChange},React.createElement(U,{className:"w-full bg-background text-foreground border-border"},React.createElement(P,{placeholder:React.createElement(V,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},a.subject)})),React.createElement(K,null,o.map(x=>React.createElement(L,{key:x.subject_name,value:x.subject_name},React.createElement(V,{key:x.subject_name,variant:"outline",className:"bg-muted text-muted-foreground border-border"},x.subject_name)))))}),l.key==="designation"&&React.createElement(z,{name:"designation",control:E,rules:{required:!0},render:({field:v})=>React.createElement(B,{value:v.value,onValueChange:v.onChange},React.createElement(U,{className:"w-full bg-background text-foreground border-border"},React.createElement(P,{placeholder:"Designation"})),React.createElement(K,null,ee.map(x=>React.createElement(L,{key:x,value:x},x))))}),l.key==="email"&&React.createElement("input",{type:"email",...k("email",{required:!0}),className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border"}),l.key==="max_hours"&&React.createElement("input",{type:"number",...k("max_hours",{required:!0}),className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border"}),l.key==="actions"&&React.createElement("div",{className:"flex gap-2"},React.createElement(T,{size:"sm",variant:"outline",onClick:()=>{i(null),g()}},React.createElement(Z,{className:"w-3 h-3"})),React.createElement(T,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-600 dark:hover:bg-blue-500",type:"submit"},React.createElement(O,{className:"w-3 h-3"}))))):I.map(l=>React.createElement(Q,{key:l.key},l.key==="name"&&React.createElement("div",{className:"font-medium"},a.name),l.key==="emp_id"&&a.emp_id,l.key==="subjects"&&React.createElement("div",{className:"flex flex-wrap gap-1"},c.filter(v=>a.name===v.teacher).map((v,x)=>React.createElement(V,{key:x,variant:"outline",className:"bg-muted text-muted-foreground border-border"},v.subject))),l.key==="designation"&&a.designation,l.key==="email"&&React.createElement("div",{className:"flex items-center gap-1"},React.createElement(Ce,{className:"w-3 h-3 text-muted-foreground"}),a.email),l.key==="max_hours"&&`${a.max_hours} hrs`,l.key==="actions"&&React.createElement("div",{className:"flex gap-2"},s===a.id?React.createElement(React.Fragment,null,React.createElement(Y,{onClick:()=>le(a)}),React.createElement(G,{onClick:()=>oe(a)})):React.createElement(React.Fragment,null,React.createElement("span",{style:{visibility:"hidden"}},React.createElement(Y,null)),React.createElement("span",{style:{visibility:"hidden"}},React.createElement(G,null)))))))),d&&React.createElement(J.tr,{key:"new-row",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},I.map(a=>React.createElement(Q,{key:a.key},a.key==="name"&&React.createElement("input",{type:"text",placeholder:"Name",className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",...y("name",{required:!0})}),a.key==="emp_id"&&React.createElement("input",{type:"text",placeholder:"Employee ID",className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",...y("emp_id",{required:!0})}),a.key==="subjects"&&React.createElement(z,{name:"subjects",control:D,rules:{required:!0},render:({field:p})=>React.createElement(B,{value:p.value,onValueChange:p.onChange},React.createElement(U,{className:"w-full bg-background text-foreground border-border"},React.createElement(P,{placeholder:"Subject"})),React.createElement(K,null,o.map(l=>React.createElement(L,{key:l.subject_name,value:l.subject_name},React.createElement(V,{key:l.subject_name,variant:"outline",className:"bg-muted text-muted-foreground border-border"},l.subject_name)))))}),a.key==="designation"&&React.createElement(z,{name:"designation",control:D,rules:{required:!0},render:({field:p})=>React.createElement(B,{value:p.value,onValueChange:p.onChange},React.createElement(U,{className:"w-full bg-background text-foreground border-border"},React.createElement(P,{placeholder:"Designation"})),React.createElement(K,null,ee.map(l=>React.createElement(L,{key:l,value:l},l))))}),a.key==="email"&&React.createElement("input",{type:"email",placeholder:"Email",className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",...y("email",{required:!0,pattern:/^\S+@\S+$/i})}),a.key==="max_hours"&&React.createElement("input",{placeholder:"Max Hours",className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",...y("max_hours",{required:!0,min:1,max:40})}),a.key==="actions"&&React.createElement("div",{className:"flex gap-2"},React.createElement(T,{size:"sm",variant:"outline",onClick:()=>{q(),b(!1)}},React.createElement(Z,{className:"w-3 h-3"})),React.createElement(T,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-600 dark:hover:bg-blue-500",onClick:M(ue)},React.createElement(O,{className:"w-3 h-3"}))))))))))))}function Ve({createStatus:e,updateStatus:r,deleteStatus:t}){R.useEffect(()=>{e.isSuccess&&C.success("Teacher created successfully!"),r.isSuccess&&C.success("Teacher updated successfully!"),t.isSuccess&&C.success("Teacher deleted successfully!"),e.isError&&C.error(`Create failed: ${e.error.message}`),r.isError&&C.error(`Update failed: ${r.error.message}`),t.isError&&C.error(`Delete failed: ${t.error.message}`)},[e,r,t])}function He(e,r,t){return R.useMemo(()=>e?.filter(s=>{const m=s.name?.toLowerCase()?.includes(r?.toLowerCase()),d=!t||s?.subject===t;return m&&d}),[e,r,t])}function wt(){const{teachers:e}=ne(),{teacherSubjects:r}=se(),t=e.map(o=>{const S=r.find(A=>A.teacher===o.name);return{...o,subject:S?S.subject:"Unknown"}}),{createStatus:s,updateStatus:m,deleteStatus:d}=X(),[b,u]=R.useState(""),[i,c]=R.useState(null);Ve({createStatus:s,updateStatus:m,deleteStatus:d});const n=He(t,b,i);return h.createElement("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-background dark:via-background dark:to-background"},h.createElement("div",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 space-y-6"},h.createElement("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},h.createElement("div",null,h.createElement("h1",{className:"text-3xl md:text-4xl font-bold text-foreground"},"Teachers Management"),h.createElement("p",{className:"text-muted-foreground mt-1"},"Manage faculty members and their details"))),h.createElement(Ae,{onSearchChange:u,onSubjectChange:c}),h.createElement(ze,{filteredTeacher:n})))}export{wt as default};
