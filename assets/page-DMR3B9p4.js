import{R as e,r as I,y as _}from"./index-DtPpba_i.js";import{C as re,a as se,b as le,c as ne}from"./card-C5vmU7Kh.js";import{u as X}from"./useClasses-BVDRfAnw.js";import{I as b,A as oe}from"./index-BboRggnA.js";import{S as H,a as P,b as O,c as G,d as V}from"./select-BMWtJq5g.js";import{S as ce,F as me,r as ie,u as K,C as W,a as de}from"./readXlsxFileBrowser-BD4tJ4_f.js";import{T as ue,a as pe,b as j,c as q,d as ge,e as s}from"./table-mMg1kOn4.js";import{B as y}from"./button-BcLH1cul.js";import{B as Ee}from"./badge-c-rzC1cp.js";import{L as fe,A as be,a as he}from"./alert-BYHIw1lO.js";import{C as Ne}from"./circle-alert-BEfX4elI.js";import{G as ve}from"./graduation-cap-ASARLn3X.js";import{P as ye}from"./plus-6CU2QWmZ.js";import{m as Z}from"./proxy-B_dnwAla.js";import{X as ee}from"./x-Cf84_0FG.js";import{C as te}from"./check-DxJMmXmV.js";import{c as xe}from"./createLucideIcon-CDU2MX3y.js";import{B as Ce}from"./building-2-C7qubgM_.js";import{U as we}from"./users-C8fy_FBV.js";import{C as Se}from"./calendar-xH3_TKQC.js";import{T as ke}from"./trash-2-R7_3k30U.js";import"./utils-Dm1jtZiZ.js";import"./queryKeys-DEtgRCDz.js";import"./useMutation-BejmEQSl.js";import"./index-DYn5w9v_.js";import"./index-Bn_Sdkge.js";import"./index-FoInwvDn.js";import"./index-CT9tpGOu.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ie=xe("layers",_e);function Ae({searchTerm:d,setSearchTerm:x,selectedDepartment:u,setSelectedDepartment:p,departments:o}){return e.createElement(re,{className:"bg-card text-card-foreground border border-border shadow-sm"},e.createElement(se,{className:"p-4 flex flex-col md:flex-row gap-4"},e.createElement("div",{className:"relative flex-1"},e.createElement(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.createElement(b,{placeholder:"Search classes...",value:d,onChange:c=>x(c.target.value),className:"pl-10 bg-background text-foreground placeholder:text-muted-foreground border-border"})),e.createElement(H,{value:u,onValueChange:p},e.createElement(P,{className:"w-[200px] bg-background text-foreground border-border"},e.createElement(O,{placeholder:"All Departments"})),e.createElement(G,{className:"bg-popover text-popover-foreground border border-border shadow-md"},e.createElement(V,{value:"all"},"All Departments"),o.map(c=>e.createElement(V,{key:c,value:c},c))))))}const ae=["Computer Science","Mathematics","Physics","Chemistry","Biology","English","History","Economics","Business","Engineering"],Le=["class_name","department","semester","section","students","academic_year"],$e=[1,2,3,4,5,6,7,8];function Te(){const{classes:d,createClassAsync:x,updateClassAsync:u}=X(),[p,o]=I.useState(!1),[c,m]=I.useState(""),i=async C=>{const g=C.target.files?.[0];if(g){o(!0),m("");try{const n=await ie(g);if(!n.length){m("The file is empty."),o(!1);return}const E=n[0].map(r=>typeof r=="string"?r.trim().toLowerCase():""),B=Le.filter(r=>!E.includes(r.toLowerCase()));if(B.length){m(`Missing required columns: ${B.join(", ")}`),o(!1);return}const f={};E.forEach((r,a)=>{r&&(f[r]=a)});const A=[],L=[];for(let r=1;r<n.length;r++){const a=n[r];if(!a||a.every(k=>k===null||k===""))continue;const N=a[f.class_name],D=a[f.department],M=a[f.semester],R=a[f.section],z=a[f.students],U=a[f.academic_year];if(N==null||D==null||M==null||R==null||z==null||U==null)continue;const v=parseInt(M,10),t=parseInt(z,10);if(Number.isNaN(v)||v<1||v>12||Number.isNaN(t)||t<=0)continue;const l=String(N).trim(),T=String(D).trim(),S=String(R).trim(),Y=String(U).trim();if(!l||!T||!S||!Y)continue;const Q={class_name:l,department:T,semester:v,section:S,students:t,academic_year:Y},J=d.find(k=>k.class_name?.toLowerCase()===l.toLowerCase()&&k.department===T&&k.semester===v&&(k.section||"").toLowerCase()===S.toLowerCase());J?L.push({id:J.id,updates:Q}):A.push(Q)}if(A.length===0&&L.length===0){m("No valid class rows found to import."),o(!1);return}let h=0,F=0;const $=[];for(const r of A)try{await x(r),h++}catch(a){$.push(`Create error for ${r.class_name} (${r.department} Sem ${r.semester} Sec ${r.section}): ${a?.message||a}`)}for(const{id:r,updates:a}of L)try{await u({id:r,updates:a}),F++}catch(N){$.push(`Update error for ${a.class_name} (${a.department} Sem ${a.semester} Sec ${a.section}): ${N?.message||N}`)}$.length&&m($.join(`
`)),(h||F)&&_.success(`Import complete: ${h} created, ${F} updated.`),C.target.value=null}catch(n){m(`Error processing file: ${n?.message||String(n)}`)}finally{o(!1)}}};return e.createElement("div",null,e.createElement(y,{variant:"outline",onClick:()=>document.getElementById("classesExcelFileInput")?.click(),disabled:p},p?e.createElement(e.Fragment,null,e.createElement(fe,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."):e.createElement(e.Fragment,null,e.createElement(me,{className:"w-4 h-4 mr-2"}),"Import Excel")),e.createElement("input",{id:"classesExcelFileInput",type:"file",className:"hidden",accept:".xlsx",onChange:i,disabled:p}),c&&e.createElement(be,{variant:"destructive",className:"mt-4 whitespace-pre-wrap"},e.createElement(Ne,{className:"h-4 w-4"}),e.createElement(he,null,c)))}function qe({classes:d,loading:x,semesters:u=$e}){const{createClassAsync:p,updateClassAsync:o,deleteClassAsync:c}=X(),[m,i]=I.useState(null),[C,g]=I.useState(!1),[n,w]=I.useState(null),{register:E,handleSubmit:B,control:f,reset:A,formState:{errors:L}}=K({defaultValues:{class_name:"",semester:void 0,section:"A",students:30,academic_year:"2024-25"}}),{register:h,handleSubmit:F,control:$,reset:r,setValue:a,formState:{errors:N}}=K(),D=t=>{w(t.id),a("class_name",t.class_name||""),a("semester",t.semester?.toString()||""),a("section",t.section||""),a("students",t.students||0),a("academic_year",t.academic_year||"")},M=async t=>{if(confirm("Are you sure you want to delete this class?"))try{await c(t),_.success("Class deleted successfully!")}catch(l){_.error(`Delete failed: ${l?.message||l}`)}},R=async t=>{try{await p({class_name:t.class_name.trim(),semester:parseInt(t.semester,10),section:t.section.trim(),students:parseInt(t.students,10),academic_year:t.academic_year.trim()}),_.success("Class created successfully!"),A(),g(!1)}catch(l){_.error(`Create failed: ${l?.message||l}`)}},z=async t=>{try{await o({id:n,updates:{class_name:t.class_name.trim(),semester:parseInt(t.semester,10),section:t.section.trim(),students:parseInt(t.students,10),academic_year:t.academic_year.trim()}}),_.success("Class updated successfully!"),w(null),r()}catch(l){_.error(`Update failed: ${l?.message||l}`)}};L&&Object.keys(L).length>0||N&&Object.keys(N).length>0;const U=({onClick:t})=>e.createElement(y,{size:"sm",variant:"outline",onClick:t},e.createElement(de,{className:"w-3 h-3"})),v=({onClick:t})=>e.createElement(y,{size:"sm",variant:"outline",onClick:t,className:"text-red-600 hover:text-red-700"},e.createElement(ke,{className:"w-3 h-3"}));return e.createElement("div",{className:"overflow-x-auto"},e.createElement("div",{className:"flex items-center gap-2 mb-4"},e.createElement("div",{className:"flex items-center gap-2 text-foreground font-semibold"},e.createElement(ve,{className:"w-5 h-5 text-violet-600 dark:text-violet-400"}),"Classes (",d.length,")"),e.createElement("div",{className:"ml-auto flex gap-2"},e.createElement(y,{className:"bg-gradient-to-r from-violet-500 to-violet-600 hover:from-violet-600 hover:to-violet-700 text-white dark:from-violet-600 dark:to-violet-700 dark:hover:from-violet-500 dark:hover:to-violet-600",onClick:()=>{g(!0),w(null)}},e.createElement(ye,{className:"w-4 h-4 mr-2"}),"Add Class"),e.createElement(Te,null))),e.createElement(ue,{className:"table-fixed w-full"},e.createElement(pe,null,e.createElement(j,null,e.createElement(q,{className:"w-[20%]"},"Class Name"),e.createElement(q,{className:"w-[10%]"},"Semester"),e.createElement(q,{className:"w-[10%]"},"Section"),e.createElement(q,{className:"w-[12%]"},"Students"),e.createElement(q,{className:"w-[16%]"},"Academic Year"),e.createElement(q,{className:"w-[16%]"}))),e.createElement(ge,null,e.createElement(oe,null,x?e.createElement(j,null,e.createElement(s,{colSpan:7,className:"text-center py-8"},"Loading classes...")):d.length===0&&!C?e.createElement(j,null,e.createElement(s,{colSpan:7,className:"text-center py-8"},"No classes found")):d.map((t,l)=>e.createElement(Z.tr,{key:t.id,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:l*.05},className:"hover:bg-accent hover:text-accent-foreground transition-colors",onMouseEnter:()=>i(t.id),onMouseLeave:()=>i(null)},n===t.id?e.createElement(e.Fragment,null,e.createElement(s,null,e.createElement(b,{...h("class_name",{required:!0}),placeholder:"Class Name",className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement(W,{name:"semester",control:$,rules:{required:!0},render:({field:T})=>e.createElement(H,{value:T.value,onValueChange:T.onChange},e.createElement(P,{className:"bg-background text-foreground border-border"},e.createElement(O,{placeholder:"Sem"})),e.createElement(G,{className:"bg-popover text-popover-foreground border border-border"},u.map(S=>e.createElement(V,{key:S,value:S.toString()},"Sem ",S))))})),e.createElement(s,null,e.createElement(b,{...h("section",{required:!0}),placeholder:"Section",className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement(b,{type:"number",min:1,...h("students",{required:!0,min:1}),placeholder:"Count",className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement(b,{...h("academic_year",{required:!0}),placeholder:"2024-25",className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement("div",{className:"flex gap-2"},e.createElement(y,{size:"sm",variant:"outline",onClick:()=>{w(null),r()}},e.createElement(ee,{className:"w-3 h-3"})),e.createElement(y,{size:"sm",className:"bg-violet-600 hover:bg-violet-700 text-white dark:bg-violet-600 dark:hover:bg-violet-500",onClick:F(z)},e.createElement(te,{className:"w-3 h-3"}))))):e.createElement(e.Fragment,null,e.createElement(s,null,e.createElement("div",{className:"flex items-center gap-2"},e.createElement(Ie,{className:"w-3 h-3 text-muted-foreground"}),e.createElement("span",{className:"font-medium"},t.class_name||t.name))),e.createElement(s,null,e.createElement("div",{className:"flex items-center gap-1"},e.createElement(Ce,{className:"w-3 h-3 text-muted-foreground"}),"Sem ",t.semester)),e.createElement(s,null,e.createElement(Ee,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},t.section)),e.createElement(s,null,e.createElement("div",{className:"flex items-center gap-1"},e.createElement(we,{className:"w-3 h-3 text-muted-foreground"}),t.students)),e.createElement(s,null,e.createElement("div",{className:"flex items-center gap-1"},e.createElement(Se,{className:"w-3 h-3 text-muted-foreground"}),t.academic_year)),e.createElement(s,null,e.createElement("div",{className:"flex gap-2"},m===t.id?e.createElement(e.Fragment,null,e.createElement(U,{onClick:()=>D(t)}),e.createElement(v,{onClick:()=>M(t.id)})):e.createElement(e.Fragment,null,e.createElement("span",{style:{visibility:"hidden"}},e.createElement(U,null)),e.createElement("span",{style:{visibility:"hidden"}},e.createElement(v,null)))))))),C&&e.createElement(Z.tr,{key:"new-class-row",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},e.createElement(s,null,e.createElement(b,{placeholder:"Class Name",...E("class_name",{required:!0}),className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement(W,{name:"semester",control:f,rules:{required:!0},render:({field:t})=>e.createElement(H,{value:t.value,onValueChange:t.onChange},e.createElement(P,{className:"bg-background text-foreground border-border"},e.createElement(O,{placeholder:"Sem"})),e.createElement(G,{className:"bg-popover text-popover-foreground border border-border"},u.map(l=>e.createElement(V,{key:l,value:l.toString()},"Sem ",l))))})),e.createElement(s,null,e.createElement(b,{placeholder:"Section",...E("section",{required:!0}),className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement(b,{type:"number",min:1,placeholder:"Count",...E("students",{required:!0,min:1}),className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement(b,{placeholder:"2024-25",...E("academic_year",{required:!0}),className:"bg-background text-foreground border-border"})),e.createElement(s,null,e.createElement("div",{className:"flex gap-2"},e.createElement(y,{size:"sm",variant:"outline",onClick:()=>{A(),g(!1)}},e.createElement(ee,{className:"w-3 h-3"})),e.createElement(y,{size:"sm",className:"bg-violet-600 hover:bg-violet-700 text-white dark:bg-violet-600 dark:hover:bg-violet-500",onClick:B(R)},e.createElement(te,{className:"w-3 h-3"})))))))))}function ct(){const{classes:d,isLoading:x}=X(),[u,p]=I.useState(""),[o,c]=I.useState("all"),m=d.filter(i=>{const C=(i.class_name||i.name||"").toLowerCase(),g=i.students??i.students_count,n=u.toLowerCase(),w=C.includes(n)||!!n&&!isNaN(Number(n))&&g!=null&&g.toString()===n,E=o==="all"||i.department===o;return w&&E});return e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-background dark:via-background dark:to-background"},e.createElement("div",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 space-y-6"},e.createElement("div",null,e.createElement("h1",{className:"text-3xl md:text-4xl font-bold text-foreground"},"Classes Management"),e.createElement("p",{className:"text-muted-foreground"},"Manage student classes and sections")),e.createElement(Ae,{searchTerm:u,setSearchTerm:p,selectedDepartment:o,setSelectedDepartment:c,departments:ae}),e.createElement(re,{className:"bg-card text-card-foreground border border-border shadow-sm"},e.createElement(le,null,e.createElement(ne,{className:"flex items-center gap-2 text-foreground"},"Classes (",m.length,")")),e.createElement(se,null,e.createElement(qe,{classes:m,loading:x,departments:ae})))))}export{ct as default};
