import{r as S,R as e,h as oe,s as V,y as ce}from"./index-DgwETXXl.js";import{u as K}from"./useSubjects-DrAFZSlr.js";import{C as ee,a as te,b as me,c as ue}from"./card-Bd3wj2iC.js";import{I as ie,A as de}from"./index-CgFL_Lmt.js";import{S as D,a as z,b as B,c as M,d as A}from"./select-C9VQ6xlo.js";import{S as pe,F as be,r as ye,u as J,C as R,a as X}from"./readXlsxFileBrowser-DyJMMn5k.js";import{T as Ee,a as fe,b as P,c as he,d as ge,e as F}from"./table-DaPbKzvm.js";import{B as k}from"./button-JwqKODJ6.js";import{B as _}from"./badge-D_6PR6ji.js";import{u as we}from"./useTeachers-BUIP1BjG.js";import{u as Q}from"./useMutation-CWkqDcyF.js";import{q as T}from"./queryKeys-DRwUXBOd.js";import{L as ke,A as Se,a as xe}from"./alert-CYx-5lkx.js";import{C as Ne}from"./circle-alert-lgjGWSdq.js";import{B as je}from"./book-open-D37L2AVm.js";import{P as ve}from"./plus-DKWVuoAd.js";import{m as Y}from"./proxy-BwaxQ4ZJ.js";import{X as W}from"./x-UGlBcBjw.js";import{C as G}from"./check-B3DRr4vU.js";import{M as Ce}from"./mail-C-B26gZ_.js";import{C as _e}from"./clock-DwQnfI_h.js";import{T as Z}from"./trash-2-FAIOSQOX.js";import"./utils-CHUdG8Hq.js";import"./index-CyI_JP6F.js";import"./index-CHRW_5Qr.js";import"./index-B96c5szH.js";import"./createLucideIcon-BsWjkkVR.js";import"./index-Ciz9C784.js";function Te({departments:r,searchTerm:a,selectedDepartment:o,onSearchChange:c,onDepartmentChange:s}){const[E,d]=S.useState(a),[n,u]=S.useState(o||"all"),i=p=>{const g=p.target.value;d(g),c(g)},m=p=>{u(p),s(p)};return e.createElement(ee,{className:"bg-card text-card-foreground border border-border shadow-sm"},e.createElement(te,{className:"p-4"},e.createElement("div",{className:"flex flex-col md:flex-row gap-4"},e.createElement("div",{className:"flex-1 relative"},e.createElement(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.createElement(ie,{placeholder:"Search subjects...",value:E,onChange:i,className:"pl-10 bg-background text-foreground placeholder:text-muted-foreground border-border"})),e.createElement(D,{value:n,onValueChange:m},e.createElement(z,{className:"w-[200px] bg-background text-foreground border-border"},e.createElement(B,{placeholder:"All Departments"})),e.createElement(M,{className:"bg-popover text-popover-foreground border border-border shadow-md"},e.createElement(A,{value:"all"},"All Departments"),r.map(p=>e.createElement(A,{key:p,value:p},p)))))))}const Ae={Theory:"bg-blue-50 text-blue-700 border-blue-200",Lab:"bg-purple-50 text-purple-700 border-purple-200"},O=["Theory","Lab"],qe=["subject_name","subject_code","credits","semester","type","hours_per_week"],H=[{key:"subject_name",label:"Name",width:"w-[18%]"},{key:"subject_code",label:"Code",width:"w-[10%]"},{key:"semester",label:"Semester",width:"w-[10%]"},{key:"type",label:"Type",width:"w-[12%]"},{key:"credits",label:"Credits",width:"w-[8%]"},{key:"hours_per_week",label:"Hours/Week",width:"w-[12%]"},{key:"actions",label:"",width:"w-[10%]"}],re=Object.freeze(["Theory","Lab"]),Le=Object.freeze({theory:"Theory",lab:"Lab"});Object.freeze(re.reduce((r,a)=>(r[a]=a.toLowerCase(),r),{}));function ae(r,{strict:a=!1,fallback:o=null}={}){if(r==null){if(a)throw new Error("Subject type missing (received null/undefined).");return o}const c=String(r).trim().toLowerCase();if(!c){if(a)throw new Error("Subject type is an empty string after trimming.");return o}const s=Le[c];if(s)return s;if(a)throw new Error(`Invalid subject type "${r}". Allowed: ${re.join(", ")}`);return o}async function Ie(r){const a=ae(r?.type??r?.subject_type,{fallback:"Theory"}),o={...r,type:a??"Theory"},{data:c,error:s}=await V.from("subjects").insert([o]).select("*").single();if(s)throw new Error(s.message||"Failed to create subject");return c}async function Fe({id:r,updates:a}){let o=a;const c=a?.type??a?.subject_type;if(c!==void 0){const d=ae(c,{fallback:"Theory"});o={...a,type:d??"Theory"}}const{data:s,error:E}=await V.from("subjects").update(o).eq("id",r).select("*").single();if(E)throw new Error(E.message||"Failed to update subject");return s}async function De(r){const{error:a}=await V.from("subjects").delete().eq("id",r);if(a)throw new Error(a.message||"Failed to delete subject");return{id:r}}function ne({createOptions:r,updateOptions:a,deleteOptions:o}={}){const c=oe(),s=Q({mutationFn:Ie,onSuccess:async(n,u,i)=>{c.setQueryData(T.subjects.all,m=>{const p=Array.isArray(m)?m:[];return[n,...p]}),await c.invalidateQueries({queryKey:T.subjects.all}),r?.onSuccess&&r.onSuccess(n,u,i)},onError:(n,u,i)=>{r?.onError&&r.onError(n,u,i)},...r}),E=Q({mutationFn:Fe,onSuccess:async(n,u,i)=>{c.setQueryData(T.subjects.all,m=>Array.isArray(m)?m.map(p=>p?.id===n?.id?{...p,...n}:p):m),await c.invalidateQueries({queryKey:T.subjects.all}),a?.onSuccess&&a.onSuccess(n,u,i)},onError:(n,u,i)=>{a?.onError&&a.onError(n,u,i)},...a}),d=Q({mutationFn:De,onSuccess:async(n,u,i)=>{const m=n?.id??u;c.setQueryData(T.subjects.all,p=>Array.isArray(p)?p.filter(g=>g?.id!==m):p),await c.invalidateQueries({queryKey:T.subjects.all}),o?.onSuccess&&o.onSuccess(n,u,i)},onError:(n,u,i)=>{o?.onError&&o.onError(n,u,i)},...o});return{createSubject:s.mutate,createSubjectAsync:s.mutateAsync,updateSubject:E.mutate,updateSubjectAsync:E.mutateAsync,deleteSubject:d.mutate,deleteSubjectAsync:d.mutateAsync,createStatus:s,updateStatus:E,deleteStatus:d}}function ze(){const{createSubjectAsync:r,updateSubjectAsync:a}=ne(),{subjects:o}=K(),[c,s]=S.useState(""),[E,d]=S.useState(!1),n=async u=>{const i=u.target.files[0];if(i){d(!0),s("");try{const m=await ye(i),g=m[0].map(b=>b&&typeof b=="string"?b.toLowerCase():""),U=qe.filter(b=>!g.includes(b.toLowerCase()));if(U.length>0){s(`Missing columns: ${U.join(", ")}`),d(!1);return}const w={};g.forEach((b,y)=>{w[b]=y});const v=[],q=[];for(let b=1;b<m.length;b++){const y=m[b];if(y.every(h=>h===null||h===""))continue;const f={subject_name:y[w.subject_name]||"",subject_code:y[w.subject_code]||"",credits:parseInt(y[w.credits]||""),department:y[w.department]||"",semester:y[w.semester]||"",type:y[w.type]||"",hours_per_week:parseInt(y[w.hours_per_week])||3},$=o.find(h=>h.credits===f.credits||h.department===f.department||h.semester===f.semester||h.type===f.type||h.hours_per_week===f.hours_per_week||h.subject_code.toLowerCase()===f.subject_code.toLowerCase());$?q.push({id:$.id,updates:f}):v.push(f)}if(v.length===0&&q.length===0){s("No valid subject data found in the file"),d(!1);return}let C=0,L=0,x=[];for(const b of v)try{await r(b),C++}catch(y){x.push(`Add error for ${b.subject_name}: ${y.message}`)}for(const{id:b,updates:y}of q)try{await a({id:b,updates:y}),L++}catch(f){x.push(`Update error for ${y.subject_name}: ${f.message}`)}x.length>0?s(x.join(`
`)):(ce.success(`Successfully imported ${C} new subjects and updated ${L} existing subjects.`),u.target.value=null)}catch(m){s(`Error processing file: ${m.message}`)}d(!1)}};return e.createElement("div",null,e.createElement(k,{variant:"outline",onClick:()=>document.getElementById("excelFileInput").click(),className:"border-border hover:bg-accent hover:text-accent-foreground transition-colors",disabled:E},E?e.createElement(e.Fragment,null,e.createElement(ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."):e.createElement(e.Fragment,null,e.createElement(be,{className:"w-4 h-4 mr-2"}),"Import Excel")),e.createElement("input",{id:"excelFileInput",type:"file",className:"hidden",accept:".xlsx",onChange:n,disabled:E}),c&&e.createElement(Se,{variant:"destructive",className:"mt-4 bg-destructive/10 text-destructive border border-destructive/30 dark:bg-destructive/20 whitespace-pre-wrap"},e.createElement(Ne,{className:"h-4 w-4"}),e.createElement(xe,null,c)))}const Be=r=>Ae[r]||"bg-muted text-muted-foreground border-border";function Me({subjects:r}){const{register:a,handleSubmit:o,reset:c,control:s,formState:{errors:E}}=J(),{register:d,handleSubmit:n,reset:u,control:i,setValue:m,formState:{errors:p}}=J(),{departments:g}=we(),{isLoading:U}=K(),[w,v]=S.useState(null),[q,C]=S.useState(!1),[L,x]=S.useState(null),{createSubjectAsync:b,updateSubjectAsync:y,deleteSubjectAsync:f}=ne(),$=({subject:t})=>e.createElement(k,{size:"sm",variant:"outline",onClick:()=>{x(t.id),m("subject_name",t.subject_name),m("subject_code",t.subject_code),m("department",t.department),m("semester",t.semester),m("type",t.type),m("credits",t.credits),m("hours_per_week",t.hours_per_week)}},e.createElement(X,{className:"w-3 h-3"})),h=({subjectId:t})=>e.createElement(k,{size:"sm",variant:"outline",onClick:async()=>await f(t),className:"text-red-600 hover:text-red-700"}," ",e.createElement(Z,{className:"w-3 h-3"})," "),se=async t=>{await y({id:L,updates:t}),x(null),u()},le=async t=>{await b(t),c(),C(!1)};return e.createElement(ee,{className:"bg-card text-card-foreground border border-border shadow-sm"},e.createElement(me,null,e.createElement(ue,{className:"flex items-center gap-2 text-foreground"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement(je,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),"Subjects (",r.length,")"),e.createElement("div",{className:"ml-auto flex items-center gap-2"},e.createElement(k,{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white dark:from-indigo-600 dark:to-indigo-700 dark:hover:from-indigo-500 dark:hover:to-indigo-600",onClick:()=>C(!0),disabled:!1},e.createElement(ve,{className:"w-4 h-4 mr-2"})," Add Subject"),e.createElement(ze,null)))),e.createElement(te,null,e.createElement("div",{className:"overflow-x-auto"},e.createElement(Ee,null,e.createElement(fe,null,e.createElement(P,null,H.map(t=>e.createElement(he,{key:t.key,className:t.width},t.label)))),e.createElement(ge,null,e.createElement(de,null,U?e.createElement(P,null,e.createElement(F,{colSpan:8,className:"text-center py-8 text-muted-foreground"},"Loading subjects...")):r.length===0?e.createElement(P,null,e.createElement(F,{colSpan:8,className:"text-center py-8 text-muted-foreground"},"No subjects found")):r.map((t,N)=>e.createElement(Y.tr,{key:t.id,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:N*.05},className:"hover:bg-accent hover:text-accent-foreground transition-colors",onMouseEnter:()=>v(t.id),onMouseLeave:()=>v(null)},L===t.id?H.map(l=>e.createElement(F,{key:l.key},l.key==="subject_name"&&e.createElement("input",{type:"text",placeholder:"Subject Name",className:"w-full border px-2 py-1 rounded",...d("subject_name",{required:!0})}),l.key==="subject_code"&&e.createElement("input",{type:"text",placeholder:"Subject Code",className:"w-full border px-2 py-1 rounded",...d("subject_code",{required:!0})}),l.key==="department"&&e.createElement(R,{name:"department",control:i,rules:{required:!0},render:({field:I})=>e.createElement(D,{value:I.value,onValueChange:I.onChange},e.createElement(z,{className:"w-full"},e.createElement(B,{placeholder:"Department"})," "),e.createElement(M,null,g.map(j=>e.createElement(A,{key:j,value:j},e.createElement(_,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},j)))))}),l.key==="semester"&&e.createElement("input",{type:"text",placeholder:"Semester",className:"w-full border px-2 py-1 rounded",...d("semester",{required:!0})}),l.key==="type"&&e.createElement(R,{name:"type",control:i,rules:{required:!0},render:({field:I})=>e.createElement(D,{value:I.value,onValueChange:I.onChange},e.createElement(z,{className:"w-full"},e.createElement(B,{placeholder:"Subject Type"})),e.createElement(M,null,O.map(j=>e.createElement(A,{key:j,value:j},e.createElement(_,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},j)))))}),l.key==="credits"&&e.createElement("input",{placeholder:"Credits",className:"w-full border px-2 py-1 rounded",...d("credits",{required:!0})}),l.key==="hours_per_week"&&e.createElement("input",{placeholder:"Hr/week",className:"w-full border px-2 py-1 rounded",...d("hours_per_week",{required:!0})}),l.key==="actions"&&e.createElement("div",{className:"flex gap-2"},e.createElement(k,{size:"sm",variant:"outline",onClick:()=>{x(null),u()}},e.createElement(W,{className:"w-3 h-3"})),e.createElement(k,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white dark:bg-indigo-600 dark:hover:bg-indigo-500",onClick:n(se)},e.createElement(G,{className:"w-3 h-3"}))))):H.map(l=>e.createElement(F,{key:l.key},l.key==="subject_name"&&e.createElement("div",{className:"font-medium"},t.subject_name),l.key==="subject_code"&&t.subject_code,l.key==="department"&&e.createElement(_,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},t.department),l.key==="semester"&&e.createElement("div",{className:"flex items-center gap-1"},e.createElement(Ce,{className:"w-3 h-3 text-muted-foreground"}),t.semester),l.key==="type"&&e.createElement(_,{variant:"outline",className:Be(t.type)}," ",t.type," "),l.key==="credits"&&t.credits,l.key==="hours_per_week"&&e.createElement("div",{className:"flex items-center gap-1"},e.createElement(_e,{className:"w-3 h-3 text-muted-foreground"}),t.hours_per_week,"h"),l.key==="actions"&&e.createElement("div",{className:"flex gap-2"},w===t.id?e.createElement(e.Fragment,null,e.createElement($,{subject:t}),e.createElement(h,{subjectId:t.id})):e.createElement(e.Fragment,null,e.createElement("span",{style:{visibility:"hidden"}},e.createElement(k,{size:"sm",variant:"outline"},e.createElement(X,{className:"w-3 h-3"}))),e.createElement("span",{style:{visibility:"hidden"}},e.createElement(k,{size:"sm",variant:"outline"},e.createElement(Z,{className:"w-3 h-3"})))))))))),q&&e.createElement(Y.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3}},H.map(t=>e.createElement(F,{key:t.key},t.key==="subject_name"&&e.createElement("input",{type:"text",placeholder:"Subject Name",className:"w-full border px-2 py-1 rounded",...a("subject_name",{required:!0})}),t.key==="subject_code"&&e.createElement("input",{type:"text",placeholder:"Subject Code",className:"w-full border px-2 py-1 rounded",...a("subject_code",{required:!0})}),t.key==="department"&&e.createElement(R,{name:"department",control:s,rules:{required:!0},render:({field:N})=>e.createElement(D,{value:N.value,onValueChange:N.onChange},e.createElement(z,{className:"w-full"},e.createElement(B,{placeholder:"Department"})),e.createElement(M,null,g.map(l=>e.createElement(A,{key:l,value:l},e.createElement(_,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},l)))))}),t.key==="semester"&&e.createElement("input",{type:"text",placeholder:"Semester",className:"w-full border px-2 py-1 rounded",...a("semester",{required:!0})}),t.key==="type"&&e.createElement(R,{name:"type",control:s,rules:{required:!0},render:({field:N})=>e.createElement(D,{value:N.value,onValueChange:N.onChange},e.createElement(z,{className:"w-full"},e.createElement(B,{placeholder:"Subject Type"})),e.createElement(M,null,O.map(l=>e.createElement(A,{key:l,value:l},e.createElement(_,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200"},l)))))}),t.key==="credits"&&e.createElement("input",{placeholder:"Credits",className:"w-full border px-2 py-1 rounded",...a("credits",{required:!0})}),t.key==="hours_per_week"&&e.createElement("input",{placeholder:"Hr/week",className:"w-full border px-2 py-1 rounded",...a("hours_per_week",{required:!0})}),t.key==="actions"&&e.createElement("div",{className:"flex gap-2"},e.createElement(k,{size:"sm",variant:"outline",onClick:()=>{c(),C(!1)}},e.createElement(W,{className:"w-3 h-3"})),e.createElement(k,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white dark:bg-indigo-600 dark:hover:bg-indigo-500",onClick:o(le)},e.createElement(G,{className:"w-3 h-3"})))))))))))}function pt(){const{subjects:r,departments:a}=K(),[o,c]=S.useState(""),[s,E]=S.useState(null),d=S.useMemo(()=>r.filter(n=>{const u=n.subject_name.toLowerCase().includes(o.toLowerCase())||n.subject_code.toLowerCase().includes(o.toLowerCase()),i=!s||n.department===s;return u&&i}),[r,o,s]);return e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-background dark:via-background dark:to-background"},e.createElement("div",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 space-y-6"},e.createElement("div",{className:"flex justify-between items-center"},e.createElement("div",null,e.createElement("h1",{className:"text-3xl md:text-4xl font-bold text-foreground"},"Subjects Management"),e.createElement("p",{className:"text-muted-foreground"},"Manage course subjects and curriculum"))),e.createElement(Te,{departments:a,searchTerm:o,selectedDepartment:s,onSearchChange:c,onDepartmentChange:n=>E(n==="all"?null:n)}),e.createElement(Me,{subjects:d})))}export{pt as default};
