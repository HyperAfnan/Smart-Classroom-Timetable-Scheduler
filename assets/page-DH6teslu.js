import{h as oe,s as z,R as e,r as C,y as T}from"./index-DgwETXXl.js";import{u as ne,q as _}from"./queryKeys-DRwUXBOd.js";import{u as j}from"./useMutation-CWkqDcyF.js";import{C as re,a as ae,b as le,c as se}from"./card-Bd3wj2iC.js";import{I as ce,A as me}from"./index-CgFL_Lmt.js";import{S as H,a as Y,b as X,c as G,d as Q}from"./select-C9VQ6xlo.js";import{S as ie,F as ue,r as de,u as O,C as W,a as ge}from"./readXlsxFileBrowser-DyJMMn5k.js";import{T as fe,a as pe,b as V,c as $,d as Ee,e as y}from"./table-DaPbKzvm.js";import{B as K}from"./badge-D_6PR6ji.js";import{B as v}from"./button-JwqKODJ6.js";import{L as ye,A as be,a as he}from"./alert-CYx-5lkx.js";import{C as we}from"./circle-alert-lgjGWSdq.js";import{M as xe}from"./map-pin-CzwWFxnn.js";import{P as Ne}from"./plus-DKWVuoAd.js";import{m as Z}from"./proxy-BwaxQ4ZJ.js";import{X as ee}from"./x-UGlBcBjw.js";import{C as te}from"./check-B3DRr4vU.js";import{U as ve}from"./users-DTvBPDpn.js";import{T as Ce}from"./trash-2-FAIOSQOX.js";import"./utils-CHUdG8Hq.js";import"./index-CyI_JP6F.js";import"./index-CHRW_5Qr.js";import"./index-B96c5szH.js";import"./createLucideIcon-BsWjkkVR.js";import"./index-Ciz9C784.js";const Se=Object.freeze([]);async function Re(){const{data:n,error:o}=await z.from("room").select("*");if(o)throw new Error(o.message||"Failed to load rooms");return n??[]}async function ke(n){const{data:o,error:l}=await z.from("room").insert([n]).select("*").single();if(l)throw new Error(l.message||"Failed to create room");return o}async function _e({id:n,updates:o}){const{data:l,error:i}=await z.from("room").update(o).eq("id",n).select("*").single();if(i)throw new Error(i.message||"Failed to update room");return l}async function Te(n){const{error:o}=await z.from("room").delete().eq("id",n);if(o)throw new Error(o.message||"Failed to delete room");return{id:n}}function J({roomsQueryOptions:n={},createOptions:o,updateOptions:l,deleteOptions:i}={}){const a=oe(),f=ne({queryKey:_.rooms.all,queryFn:Re,staleTime:6e4,...n}),p=j({mutationFn:ke,onSuccess:async(s,c,u)=>{a.setQueryData(_.rooms.all,d=>{const r=Array.isArray(d)?d:[];return[s,...r]}),await a.invalidateQueries({queryKey:_.rooms.all}),o?.onSuccess&&o.onSuccess(s,c,u)},onError:(s,c,u)=>{o?.onError&&o.onError(s,c,u)},...o}),b=j({mutationFn:_e,onSuccess:async(s,c,u)=>{a.setQueryData(_.rooms.all,d=>Array.isArray(d)?d.map(r=>r?.id===s?.id?{...r,...s}:r):d),await a.invalidateQueries({queryKey:_.rooms.all}),l?.onSuccess&&l.onSuccess(s,c,u)},onError:(s,c,u)=>{l?.onError&&l.onError(s,c,u)},...l}),h=j({mutationFn:Te,onSuccess:async(s,c,u)=>{const d=s?.id??c;a.setQueryData(_.rooms.all,r=>Array.isArray(r)?r.filter(m=>m?.id!==d):r),await a.invalidateQueries({queryKey:_.rooms.all}),i?.onSuccess&&i.onSuccess(s,c,u)},onError:(s,c,u)=>{i?.onError&&i.onError(s,c,u)},...i}),x=!!(p.isPending||b.isPending),E=!!h.isPending,q=p.mutateAsync,S=b.mutateAsync,R=h.mutateAsync,A=f.isLoading,w=f.isError,N=f.error??null;return{rooms:f.data??Se,isLoading:A,isError:w,error:N,refetch:f.refetch,roomsQuery:f,createRoomAsync:q,updateRoomAsync:S,deleteRoomAsync:R,createStatus:p,updateStatus:b,deleteStatus:h,isSubmitting:x,isDeleting:E}}const D=["Lecture","Lab"],Ae={Lecture:"bg-blue-50 text-blue-700 border-blue-200",Lab:"bg-green-50 text-green-700 border-green-200"},Fe=["room_number","capacity","room_type"];function Le({searchTerm:n,setSearchTerm:o,selectedType:l,setSelectedType:i}){return e.createElement(re,{className:"bg-card text-card-foreground border border-border shadow-sm"},e.createElement(ae,{className:"p-4"},e.createElement("div",{className:"flex flex-col md:flex-row gap-4"},e.createElement("div",{className:"flex-1 relative"},e.createElement(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.createElement(ce,{placeholder:"Search rooms...",value:n,onChange:a=>o(a.target.value),className:"pl-10 bg-background text-foreground placeholder:text-muted-foreground border-border"})),e.createElement(H,{value:l,onValueChange:i},e.createElement(Y,{className:"w-[200px] bg-background text-foreground border-border"},e.createElement(X,{placeholder:"All Room Types"})),e.createElement(G,{className:"bg-popover text-popover-foreground border border-border shadow-md"},e.createElement(Q,{value:"all"},"All Room Types"),D.map(a=>e.createElement(Q,{key:a,value:a},a)))))))}function Ie(){const{rooms:n,createRoomAsync:o,updateRoomAsync:l}=J(),[i,a]=C.useState(""),[f,p]=C.useState(!1),b=async h=>{const x=h.target.files?.[0];if(x){p(!0),a("");try{const E=await de(x);if(!E.length){a("The file appears to be empty."),p(!1);return}const S=E[0].map(r=>r&&typeof r=="string"?r.trim().toLowerCase():""),R=Fe.filter(r=>!S.includes(r.toLowerCase()));if(R.length>0){a(`Missing required columns: ${R.join(", ")}`),p(!1);return}const A=S.includes("name"),w={};S.forEach((r,m)=>{r&&(w[r]=m)});const N=[],s=[];for(let r=1;r<E.length;r++){const m=E[r];if(!m||m.every(B=>B===null||B===""))continue;const k=m[w.room_number],M=m[w.capacity],P=m[w.room_type],U=A?m[w.name]:void 0;if(!k||!P||!M&&M!==0)continue;const F=parseInt(M,10);if(isNaN(F)||F<=0)continue;const t=String(P).trim();if(!D.includes(t))continue;const g=String(k).trim(),L={room_number:g,capacity:F,room_type:t};A&&U&&(L.name=String(U).trim());const I=n.find(B=>B.room_number?.toLowerCase()===g.toLowerCase());I?s.push({id:I.id,updates:L}):N.push(L)}if(N.length===0&&s.length===0){a("No valid room rows found to import."),p(!1);return}let c=0,u=0;const d=[];for(const r of N)try{await o(r),c++}catch(m){d.push(`Create error for ${r.room_number}: ${m?.message||m}`)}for(const{id:r,updates:m}of s)try{await l({id:r,updates:m}),u++}catch(k){d.push(`Update error for ${m.room_number}: ${k?.message||k}`)}d.length>0&&a(d.join(`
`)),(c||u)&&T.success(`Import complete: ${c} created, ${u} updated.`),h.target.value=null}catch(E){a(`Error processing file: ${E?.message||String(E)}`)}finally{p(!1)}}};return e.createElement("div",null,e.createElement(v,{variant:"outline",onClick:()=>document.getElementById("roomExcelFileInput").click(),disabled:f,className:"border-border hover:bg-accent hover:text-accent-foreground transition-colors"},f?e.createElement(e.Fragment,null,e.createElement(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."):e.createElement(e.Fragment,null,e.createElement(ue,{className:"w-4 h-4 mr-2"}),"Import Excel")),e.createElement("input",{id:"roomExcelFileInput",type:"file",className:"hidden",accept:".xlsx",onChange:b,disabled:f}),i&&e.createElement(be,{variant:"destructive",className:"mt-4 whitespace-pre-wrap bg-destructive/10 text-destructive border border-destructive/30 dark:bg-destructive/20"},e.createElement(we,{className:"h-4 w-4"}),e.createElement(he,null,i)))}function qe({rooms:n,loading:o}){const{createRoomAsync:l,updateRoomAsync:i,deleteRoomAsync:a}=J(),[f,p]=C.useState(null),[b,h]=C.useState(!1),[x,E]=C.useState(null),{register:q,handleSubmit:S,reset:R,control:A,formState:{errors:w}}=O(),{register:N,handleSubmit:s,reset:c,control:u,setValue:d,formState:{errors:r}}=O(),m=async t=>{if(confirm("Are you sure you want to delete this room?"))try{await a(t),T.success("Room deleted successfully!")}catch(g){T.error(`Delete failed: ${g?.message||g}`)}},k=t=>{E(t.id),d("room_number",t.room_number),d("room_type",t.room_type),d("capacity",t.capacity)},M=async t=>{try{await l({room_number:t.room_number.trim(),room_type:t.room_type,capacity:parseInt(t.capacity,10)}),T.success("Room created successfully!"),R(),h(!1)}catch(g){T.error(`Create failed: ${g?.message||g}`)}},P=async t=>{try{await i({id:x,updates:{room_number:t.room_number.trim(),room_type:t.room_type,capacity:parseInt(t.capacity,10)}}),T.success("Room updated successfully!"),E(null),c()}catch(g){T.error(`Update failed: ${g?.message||g}`)}};w&&Object.keys(w).length||r&&Object.keys(r).length;const U=({onClick:t})=>e.createElement(v,{size:"sm",variant:"outline",onClick:t},e.createElement(ge,{className:"w-3 h-3"})),F=({onClick:t})=>e.createElement(v,{size:"sm",variant:"outline",onClick:t,className:"text-red-600 hover:text-red-700"},e.createElement(Ce,{className:"w-3 h-3"}));return e.createElement(re,{className:"bg-card text-card-foreground border border-border shadow-sm"},e.createElement(le,null,e.createElement(se,{className:"flex items-center gap-2 text-foreground"},e.createElement(xe,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"}),"Rooms (",n.length,")",e.createElement("div",{className:"flex gap-2 ml-auto"},e.createElement(v,{className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white dark:from-green-600 dark:to-green-700 dark:hover:from-green-500 dark:hover:to-green-600",onClick:()=>{h(!0),E(null)}},e.createElement(Ne,{className:"w-4 h-4 mr-2"}),"Add Room"),e.createElement(Ie,null)))),e.createElement(ae,null,e.createElement("div",{className:"overflow-x-auto"},e.createElement(fe,{className:"table-fixed w-full"},e.createElement(pe,null,e.createElement(V,null,e.createElement($,{className:"w-[25%]"},"Room"),e.createElement($,{className:"w-[25%]"},"Type"),e.createElement($,{className:"w-[20%]"},"Capacity"),e.createElement($,{className:"w-[20%]"}))),e.createElement(Ee,null,e.createElement(me,null,o?e.createElement(V,null,e.createElement(y,{colSpan:4,className:"text-center py-8 text-muted-foreground"},"Loading rooms...")):n.length===0&&!b?e.createElement(V,null,e.createElement(y,{colSpan:4,className:"text-center py-8 text-muted-foreground"},"No rooms found")):n.map((t,g)=>e.createElement(Z.tr,{key:t.id,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:g*.05},className:"hover:bg-accent hover:text-accent-foreground transition-colors",onMouseEnter:()=>p(t.id),onMouseLeave:()=>p(null)},x===t.id?e.createElement(e.Fragment,null,e.createElement(y,null,e.createElement("input",{...N("room_number",{required:!0}),className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",placeholder:"Room Number"})),e.createElement(y,null,e.createElement(W,{name:"room_type",control:u,rules:{required:!0},render:({field:L})=>e.createElement(H,{value:L.value,onValueChange:L.onChange},e.createElement(Y,{className:"w-full bg-background text-foreground border-border"},e.createElement(X,{placeholder:"Type"})),e.createElement(G,null,D.map(I=>e.createElement(Q,{key:I,value:I},e.createElement(K,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},I)))))})),e.createElement(y,null,e.createElement("input",{type:"number",min:"1",...N("capacity",{required:!0,min:1}),className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",placeholder:"Capacity"})),e.createElement(y,null,e.createElement("div",{className:"flex gap-2"},e.createElement(v,{size:"sm",variant:"outline",onClick:()=>{E(null),c()}},e.createElement(ee,{className:"w-3 h-3"})),e.createElement(v,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white dark:bg-green-600 dark:hover:bg-green-500",onClick:s(P)},e.createElement(te,{className:"w-3 h-3"}))))):e.createElement(e.Fragment,null,e.createElement(y,null,e.createElement("div",{className:"font-medium"},t.room_number),t.name&&e.createElement("div",{className:"text-xs text-muted-foreground mt-1"},t.name)),e.createElement(y,null,e.createElement(K,{variant:"outline",className:Ae[t.room_type]||"bg-muted text-muted-foreground border-border"},t.room_type)),e.createElement(y,null,e.createElement("div",{className:"flex items-center gap-1"},e.createElement(ve,{className:"w-3 h-3 text-muted-foreground"})," ",t.capacity)),e.createElement(y,null,e.createElement("div",{className:"flex gap-2"},f===t.id?e.createElement(e.Fragment,null,e.createElement(U,{onClick:()=>k(t)}),e.createElement(F,{onClick:()=>m(t.id)})):e.createElement(e.Fragment,null,e.createElement("span",{style:{visibility:"hidden"}},e.createElement(U,null)),e.createElement("span",{style:{visibility:"hidden"}},e.createElement(F,null)))))))),b&&e.createElement(Z.tr,{key:"new-row",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20}},e.createElement(y,null,e.createElement("input",{type:"text",placeholder:"Room Number",className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",...q("room_number",{required:!0})})),e.createElement(y,null,e.createElement(W,{name:"room_type",control:A,rules:{required:!0},render:({field:t})=>e.createElement(H,{value:t.value,onValueChange:t.onChange},e.createElement(Y,{className:"w-full bg-background text-foreground border-border"},e.createElement(X,{placeholder:"Type"})),e.createElement(G,null,D.map(g=>e.createElement(Q,{key:g,value:g},e.createElement(K,{variant:"outline",className:"bg-muted text-muted-foreground border-border"},g)))))})),e.createElement(y,null,e.createElement("input",{type:"number",placeholder:"Capacity",className:"w-full border px-2 py-1 rounded bg-background text-foreground border-border",...q("capacity",{required:!0,min:1}),min:"1"})),e.createElement(y,null,e.createElement("div",{className:"flex gap-2"},e.createElement(v,{size:"sm",variant:"outline",onClick:()=>{R(),h(!1)}},e.createElement(ee,{className:"w-3 h-3"})),e.createElement(v,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white dark:bg-green-600 dark:hover:bg-green-500",onClick:S(M)},e.createElement(te,{className:"w-3 h-3"})))))))))))}function lt(){const{rooms:n,isLoading:o}=J(),[l,i]=C.useState(""),[a,f]=C.useState("all"),p=C.useMemo(()=>n.filter(b=>{const h=(b.room_number??"").toLowerCase().includes(l.toLowerCase())||(b.name??"").toLowerCase().includes(l.toLowerCase()),x=a==="all"||b.room_type===a;return h&&x}),[n,l,a]);return e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-background dark:via-background dark:to-background"},e.createElement("div",{className:"max-w-6xl mx-auto px-4 py-8 md:py-12 space-y-6"},e.createElement("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},e.createElement("div",null,e.createElement("h1",{className:"text-3xl md:text-4xl font-bold text-foreground"},"Rooms Management"),e.createElement("p",{className:"text-muted-foreground mt-1"},"Manage classroom and facility resources"))),e.createElement(Le,{searchTerm:l,setSearchTerm:i,selectedType:a,setSelectedType:f}),e.createElement(qe,{rooms:p,loading:o})))}export{lt as default};
