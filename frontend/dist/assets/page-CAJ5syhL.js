import{j as e,r as I,y as E}from"./index-DMwWV6LZ.js";import{C as te,a as re,b as ne,c as le}from"./card-CZDdEFOl.js";import{u as X}from"./useClasses-Jstt2_tI.js";import{I as f}from"./input-D6FpiF2T.js";import{S as H,a as P,b as O,c as G,d as z,T as ie,e as ce,f as V,g as T,h as oe,i as r}from"./table-BhjpBg1z.js";import{S as de,F as me,r as ue,u as K,C as W,a as he}from"./readXlsxFileBrowser-B_cWmW9H.js";import{B as N}from"./button-DdLPv1v6.js";import{B as xe}from"./badge-lPAdpJMK.js";import{L as pe,A as je,a as fe,C as Z}from"./alert-CjM6HumU.js";import{C as ge}from"./circle-alert-DaODrJr0.js";import{G as Ce}from"./graduation-cap-VZGpxI3y.js";import{P as ye}from"./plus-DJfzYg-M.js";import{A as Ne}from"./index-Bs2UPQaf.js";import{m as ee}from"./proxy-BVDPlYaL.js";import{X as se}from"./x-DXQQL3e4.js";import{c as we}from"./createLucideIcon-De5o52GV.js";import{B as Se}from"./building-2-BtY7HNjz.js";import{U as ve}from"./users-BpObsUQF.js";import{C as be}from"./calendar-BEswqjrj.js";import{T as _e}from"./trash-2-CGwPMucJ.js";import"./queryKeys-B8YbpHg6.js";import"./useMutation-rOajDVhN.js";import"./index-Dy3eTchR.js";import"./index-CK0ERQAK.js";import"./index-B5rXH1kc.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ie=we("layers",Ee);function Ae({searchTerm:m,setSearchTerm:w,selectedDepartment:u,setSelectedDepartment:h,departments:i}){return e.jsx(te,{children:e.jsxs(re,{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(f,{placeholder:"Search classes...",value:m,onChange:c=>w(c.target.value),className:"pl-10"})]}),e.jsxs(H,{value:u,onValueChange:h,children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(O,{placeholder:"All Departments"})}),e.jsxs(G,{children:[e.jsx(z,{value:"all",children:"All Departments"}),i.map(c=>e.jsx(z,{value:c,children:c},c))]})]})]})})}const ae=["Computer Science","Mathematics","Physics","Chemistry","Biology","English","History","Economics","Business","Engineering"],Le=["class_name","department","semester","section","students","academic_year"],ke=[1,2,3,4,5,6,7,8];function $e(){const{classes:m,createClassAsync:w,updateClassAsync:u}=X(),[h,i]=I.useState(!1),[c,o]=I.useState(""),d=async S=>{const x=S.target.files?.[0];if(x){i(!0),o("");try{const l=await ue(x);if(!l.length){o("The file is empty."),i(!1);return}const p=l[0].map(t=>typeof t=="string"?t.trim().toLowerCase():""),U=Le.filter(t=>!p.includes(t.toLowerCase()));if(U.length){o(`Missing required columns: ${U.join(", ")}`),i(!1);return}const j={};p.forEach((t,a)=>{t&&(j[t]=a)});const A=[],L=[];for(let t=1;t<l.length;t++){const a=l[t];if(!a||a.every(_=>_===null||_===""))continue;const C=a[j.class_name],B=a[j.department],D=a[j.semester],M=a[j.section],R=a[j.students],F=a[j.academic_year];if(C==null||B==null||D==null||M==null||R==null||F==null)continue;const y=parseInt(D,10),s=parseInt(R,10);if(Number.isNaN(y)||y<1||y>12||Number.isNaN(s)||s<=0)continue;const n=String(C).trim(),$=String(B).trim(),b=String(M).trim(),Y=String(F).trim();if(!n||!$||!b||!Y)continue;const Q={class_name:n,department:$,semester:y,section:b,students:s,academic_year:Y},J=m.find(_=>_.class_name?.toLowerCase()===n.toLowerCase()&&_.department===$&&_.semester===y&&(_.section||"").toLowerCase()===b.toLowerCase());J?L.push({id:J.id,updates:Q}):A.push(Q)}if(A.length===0&&L.length===0){o("No valid class rows found to import."),i(!1);return}let g=0,q=0;const k=[];for(const t of A)try{await w(t),g++}catch(a){k.push(`Create error for ${t.class_name} (${t.department} Sem ${t.semester} Sec ${t.section}): ${a?.message||a}`)}for(const{id:t,updates:a}of L)try{await u({id:t,updates:a}),q++}catch(C){k.push(`Update error for ${a.class_name} (${a.department} Sem ${a.semester} Sec ${a.section}): ${C?.message||C}`)}k.length&&o(k.join(`
`)),(g||q)&&E.success(`Import complete: ${g} created, ${q} updated.`),S.target.value=null}catch(l){o(`Error processing file: ${l?.message||String(l)}`)}finally{i(!1)}}};return e.jsxs("div",{children:[e.jsx(N,{variant:"outline",onClick:()=>document.getElementById("classesExcelFileInput")?.click(),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Import Excel"]})}),e.jsx("input",{id:"classesExcelFileInput",type:"file",className:"hidden",accept:".xlsx",onChange:d,disabled:h}),c&&e.jsxs(je,{variant:"destructive",className:"mt-4 whitespace-pre-wrap",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(fe,{children:c})]})]})}function Te({classes:m,loading:w,semesters:u=ke}){const{createClassAsync:h,updateClassAsync:i,deleteClassAsync:c}=X(),[o,d]=I.useState(null),[S,x]=I.useState(!1),[l,v]=I.useState(null),{register:p,handleSubmit:U,control:j,reset:A,formState:{errors:L}}=K({defaultValues:{class_name:"",semester:void 0,section:"A",students:30,academic_year:"2024-25"}}),{register:g,handleSubmit:q,control:k,reset:t,setValue:a,formState:{errors:C}}=K(),B=s=>{v(s.id),a("class_name",s.class_name||""),a("semester",s.semester?.toString()||""),a("section",s.section||""),a("students",s.students||0),a("academic_year",s.academic_year||"")},D=async s=>{if(confirm("Are you sure you want to delete this class?"))try{await c(s),E.success("Class deleted successfully!")}catch(n){E.error(`Delete failed: ${n?.message||n}`)}},M=async s=>{try{await h({class_name:s.class_name.trim(),semester:parseInt(s.semester,10),section:s.section.trim(),students:parseInt(s.students,10),academic_year:s.academic_year.trim()}),E.success("Class created successfully!"),A(),x(!1)}catch(n){E.error(`Create failed: ${n?.message||n}`)}},R=async s=>{try{await i({id:l,updates:{class_name:s.class_name.trim(),semester:parseInt(s.semester,10),section:s.section.trim(),students:parseInt(s.students,10),academic_year:s.academic_year.trim()}}),E.success("Class updated successfully!"),v(null),t()}catch(n){E.error(`Update failed: ${n?.message||n}`)}};L&&Object.keys(L).length>0||C&&Object.keys(C).length>0;const F=({onClick:s})=>e.jsx(N,{size:"sm",variant:"outline",onClick:s,children:e.jsx(he,{className:"w-3 h-3"})}),y=({onClick:s})=>e.jsx(N,{size:"sm",variant:"outline",onClick:s,className:"text-red-600 hover:text-red-700",children:e.jsx(_e,{className:"w-3 h-3"})});return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 font-semibold",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Classes (",m.length,")"]}),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsxs(N,{className:"bg-gradient-to-r from-violet-500 to-violet-600 hover:from-violet-600 hover:to-violet-700",onClick:()=>{x(!0),v(null)},children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Add Class"]}),e.jsx($e,{})]})]}),e.jsxs(ie,{className:"table-fixed w-full",children:[e.jsx(ce,{children:e.jsxs(V,{children:[e.jsx(T,{className:"w-[20%]",children:"Class Name"}),e.jsx(T,{className:"w-[10%]",children:"Semester"}),e.jsx(T,{className:"w-[10%]",children:"Section"}),e.jsx(T,{className:"w-[12%]",children:"Students"}),e.jsx(T,{className:"w-[16%]",children:"Academic Year"}),e.jsx(T,{className:"w-[16%]"})]})}),e.jsx(oe,{children:e.jsxs(Ne,{children:[w?e.jsx(V,{children:e.jsx(r,{colSpan:7,className:"text-center py-8",children:"Loading classes..."})}):m.length===0&&!S?e.jsx(V,{children:e.jsx(r,{colSpan:7,className:"text-center py-8",children:"No classes found"})}):m.map((s,n)=>e.jsx(ee.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:n*.05},className:"hover:bg-slate-50",onMouseEnter:()=>d(s.id),onMouseLeave:()=>d(null),children:l===s.id?e.jsxs(e.Fragment,{children:[e.jsx(r,{children:e.jsx(f,{...g("class_name",{required:!0}),placeholder:"Class Name"})}),e.jsx(r,{children:e.jsx(W,{name:"semester",control:k,rules:{required:!0},render:({field:$})=>e.jsxs(H,{value:$.value,onValueChange:$.onChange,children:[e.jsx(P,{children:e.jsx(O,{placeholder:"Sem"})}),e.jsx(G,{children:u.map(b=>e.jsxs(z,{value:b.toString(),children:["Sem ",b]},b))})]})})}),e.jsx(r,{children:e.jsx(f,{...g("section",{required:!0}),placeholder:"Section"})}),e.jsx(r,{children:e.jsx(f,{type:"number",min:1,...g("students",{required:!0,min:1}),placeholder:"Count"})}),e.jsx(r,{children:e.jsx(f,{...g("academic_year",{required:!0}),placeholder:"2024-25"})}),e.jsx(r,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{v(null),t()},children:e.jsx(se,{className:"w-3 h-3"})}),e.jsx(N,{size:"sm",className:"bg-violet-500 text-white",onClick:q(R),children:e.jsx(Z,{className:"w-3 h-3"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-3 h-3 text-slate-400"}),e.jsx("span",{className:"font-medium",children:s.class_name||s.name})]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3 text-slate-400"}),"Sem ",s.semester]})}),e.jsx(r,{children:e.jsx(xe,{variant:"outline",className:"bg-slate-50 text-slate-700 border-slate-200",children:s.section})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3 text-slate-400"}),s.students]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3 text-slate-400"}),s.academic_year]})}),e.jsx(r,{children:e.jsx("div",{className:"flex gap-2",children:o===s.id?e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>B(s)}),e.jsx(y,{onClick:()=>D(s.id)})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{visibility:"hidden"},children:e.jsx(F,{})}),e.jsx("span",{style:{visibility:"hidden"},children:e.jsx(y,{})})]})})})]})},s.id)),S&&e.jsxs(ee.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[e.jsx(r,{children:e.jsx(f,{placeholder:"Class Name",...p("class_name",{required:!0})})}),e.jsx(r,{children:e.jsx(W,{name:"semester",control:j,rules:{required:!0},render:({field:s})=>e.jsxs(H,{value:s.value,onValueChange:s.onChange,children:[e.jsx(P,{children:e.jsx(O,{placeholder:"Sem"})}),e.jsx(G,{children:u.map(n=>e.jsxs(z,{value:n.toString(),children:["Sem ",n]},n))})]})})}),e.jsx(r,{children:e.jsx(f,{placeholder:"Section",...p("section",{required:!0})})}),e.jsx(r,{children:e.jsx(f,{type:"number",min:1,placeholder:"Count",...p("students",{required:!0,min:1})})}),e.jsx(r,{children:e.jsx(f,{placeholder:"2024-25",...p("academic_year",{required:!0})})}),e.jsx(r,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{A(),x(!1)},children:e.jsx(se,{className:"w-3 h-3"})}),e.jsx(N,{size:"sm",className:"bg-violet-500 text-white",onClick:U(M),children:e.jsx(Z,{className:"w-3 h-3"})})]})})]},"new-class-row")]})})]})]})}function ns(){const{classes:m,isLoading:w}=X(),[u,h]=I.useState(""),[i,c]=I.useState("all"),o=m.filter(d=>{const S=(d.class_name||d.name||"").toLowerCase(),x=d.students??d.students_count,l=u.toLowerCase(),v=S.includes(l)||!!l&&!isNaN(Number(l))&&x!=null&&x.toString()===l,p=i==="all"||d.department===i;return v&&p});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Classes Management"}),e.jsx("p",{className:"text-slate-600",children:"Manage student classes and sections"})]}),e.jsx(Ae,{searchTerm:u,setSearchTerm:h,selectedDepartment:i,setSelectedDepartment:c,departments:ae}),e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(le,{className:"flex items-center gap-2",children:["Classes (",o.length,")"]})}),e.jsx(re,{children:e.jsx(Te,{classes:o,loading:w,departments:ae})})]})]})}export{ns as default};
